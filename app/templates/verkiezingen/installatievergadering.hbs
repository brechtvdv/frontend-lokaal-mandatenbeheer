{{page-title "Voorbereiding legislatuur"}}
{{breadcrumb
  this.title
  " "
  this.model.selectedPeriod.label
  route="verkiezingen.installatievergadering"
}}

{{#if (or (not @model.isRelevant) (not @model.installatievergadering))}}
  <div class="au-o-box">
    <div class="au-o-flow">
      <AuHeading @skin="2">{{this.title}}</AuHeading>
    </div>
  </div>
  <div class="au-o-box">
    <AuAlert @icon="info-circle" @size="small">
      <p>De voorbereiding van de legislatuur is niet mogelijk in de
        bestuurseenheid
        {{@model.bestuurseenheid.classificatie.label}}
        {{@model.bestuurseenheid.naam}}.</p>
      <p>
        De voorbereiding van de legislatuur gebeurt in de bestuurseenheid
        Gemeente
        {{@model.bestuurseenheid.naam}}</p>
    </AuAlert>
  </div>
{{else}}
  <AuToolbar
    @size="large"
    @nowrap="true"
    class="au-u-padding-bottom-none"
    as |Group|
  >
    <Group>
      <div class="au-o-flow au-u-flex">
        <AuHeading @skin="2">
          {{this.title}}
          <br />
          <div class="au-u-padding-right-large au-u-light">
            <Mandatenbeheer::BestuursperiodenSelector
              @options={{@model.bestuursPeriods}}
              @selected={{@model.selectedPeriod}}
              @onSelect={{this.selectPeriod}}
              @prefix="Bestuursperiode"
            />
          </div>
        </AuHeading>
        <span
          class="au-u-margin-top-none au-u-padding-top-small au-u-padding-left-small"
        >
          <AuPill @skin={{this.statusPillSkin}}>
            {{this.statusPillLabel}}
          </AuPill>
        </span>
      </div>
    </Group>
    <Group>
      <AuLink
        @route="verkiezingen.verkiezingsuitslag"
        @model={{@model.selectedPeriod.id}}
        @skin="button-secondary"
      >Bekijk verkiezingsuitslag
        {{this.model.selectedPeriod.start}}
      </AuLink>
      <AuButton
        @disabled={{not this.nextStatus.status}}
        @icon={{this.nextStatus.icon}}
        @loading={{this.setNextStatus.isRunning}}
        @loadingMessage="Volgende status ophalen"
        {{on "click" (fn this.selectStatus this.nextStatus.status)}}
      >
        {{this.nextStatus.label}}
      </AuButton>
    </Group>
  </AuToolbar>
  <div class="au-c-body-container au-c-body-container--scroll">
    {{#unless @model.isBehandeld}}
      <Verkiezingen::KieslijstSplitter
        @kandidatenlijst={{@model.kandidatenlijsten}}
        @bestuursorgaan={{@model.bestuursorganenInTijd}}
        @bestuurseenheid={{@model.bestuurseenheid}}
      />
    {{/unless}}

    {{#each @model.bestuursorganenInTijd as |bestuursorgaan|}}
      <Verkiezingen::PrepareLegislatuurSection
        @isBehandeld={{@model.isBehandeld}}
        @bestuursorgaan={{bestuursorgaan}}
        @bestuursorganen={{@model.bestuursorganenInTijd}}
        @sort={{this.sort}}
        @form={{@model.mandatarisNewForm}}
      />
    {{/each}}

    {{! Keeping the selector for development purposes }}
    {{#unless true}}
      <div class="au-o-box">
        <Tmp::Todo>
          <p>Change installatievergadering status:</p>
          <Shared::InstallatievergaderingStatusSelector
            @options={{@model.ivStatuses}}
            @selectedStatus={{@model.installatievergadering.status}}
            @onSelect={{this.selectStatus}}
          />
        </Tmp::Todo>
      </div>
    {{/unless}}
  </div>
{{/if}}